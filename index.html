<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quick Quotes UK - Milk Run</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
input { margin: 5px; padding: 5px; width: 250px; }
button { padding: 5px 10px; margin: 5px; }
#map { height: 400px; margin-top: 20px; }
table { border-collapse: collapse; margin-top: 10px; }
th, td { padding: 6px 10px; border: 1px solid #555; text-align: center; }
</style>
</head>
<body>

<h2>ğŸš Quick Quotes UK - Milk Run</h2>

<input id="pickup1" placeholder="Pickup 1 postcode or address">
<input id="pickup2" placeholder="Pickup 2 postcode or address (optional)">
<input id="pickup3" placeholder="Pickup 3 postcode or address (optional)">
<input id="delivery" placeholder="Delivery postcode or address">

<button onclick="calculateAllQuotes()">Calculate All Quotes</button>

<h3 id="result"></h3>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
let map = L.map('map').setView([51.5,-0.12],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

// Vehicles and rates (+10% applied)
const vehicles = {
  "SWB": 1.1,
  "MWB": 1.155,
  "LWB": 1.21,
  "XLWB": 1.265,
  "Luton": 1.32,
  "7.5T": 2.64,
  "18T": 2.75,
  "Artic": 3.3
};

// Get coordinates
async function getCoords(address){
  try{
    let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
    let res = await axios.get(url);
    if(res.data.length > 0) return [parseFloat(res.data[0].lat), parseFloat(res.data[0].lon)];
    return null;
  }catch(e){
    alert("Error fetching coordinates");
    return null;
  }
}

// Calculate quotes
async function calculateAllQuotes(){
  const pickups = [
    document.getElementById("pickup1").value,
    document.getElementById("pickup2").value,
    document.getElementById("pickup3").value
  ].filter(p => p);
  const delivery = document.getElementById("delivery").value;

  if(pickups.length === 0 || !delivery){
    alert("Enter at least 1 pickup and delivery");
    return;
  }

  // Get coordinates
  const coordsList = [];
  for(const p of pickups){
    const c = await getCoords(p);
    if(!c){ alert(`Pickup not found: ${p}`); return; }
    coordsList.push(c);
  }
  const deliveryCoords = await getCoords(delivery);
  if(!deliveryCoords){ alert("Delivery address not found"); return; }
  coordsList.push(deliveryCoords);

  // Clear old markers and lines
  map.eachLayer(layer => { if(layer instanceof L.Marker || layer instanceof L.Polyline) map.removeLayer(layer); });

  // Add markers
  coordsList.forEach((c,i)=>{
    let label = (i < pickups.length) ? `Pickup ${i+1}` : 'Delivery';
    L.marker(c).addTo(map).bindPopup(label);
  });

  // Draw line connecting all points
  L.polyline(coordsList, {color:'blue', weight:4, opacity:0.7}).addTo(map);
  map.fitBounds(coordsList);

  // Calculate distances between consecutive points
  let segmentDistances = [];
  for(let i=0;i<coordsList.length-1;i++){
    const from = coordsList[i];
    const to = coordsList[i+1];
    const route = await axios.get(`https://router.project-osrm.org/route/v1/driving/${from[1]},${from[0]};${to[1]},${to[0]}?overview=false`);
    segmentDistances.push(route.data.routes[0].distance / 1609); // miles
  }

  // Build table
  let html = `<table><tr><th>Vehicle</th>`;
  pickups.forEach((p,i)=>{ html+=`<th>Pickup ${i+1}</th>` });
  html += `<th>Delivery (Principal)</th><th>Total (Â£)</th></tr>`;

  for(const [veh, rate] of Object.entries(vehicles)){
    let totalTransport = 0;
    html += `<tr><td>${veh}</td>`;
    segmentDistances.forEach((dist,i)=>{
      let cost;
      if(i === 0){
        // Pickup 1 â†’ fÄƒrÄƒ taxa suplimentarÄƒ
        cost = dist*rate;
      } else if(i < pickups.length){
        // Pickup 2 È™i 3 â†’ Â£40 + dist*rate
        cost = 40 + dist*rate;
      } else {
        // Delivery â†’ minim Â£65
        cost = Math.max(dist*rate, 65);
      }
      totalTransport += cost;
      html += `<td>Â£${cost.toFixed(2)}</td>`;
    });
    html += `<td>Â£${(totalTransport*1.05).toFixed(2)}</td></tr>`;
  }

  html += `</table>`;
  document.getElementById("result").innerHTML = html;
}
</script>

</body>
</html>
-
