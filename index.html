<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quick Quotes UK</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input { margin: 5px; padding: 5px; width: 250px; }
    button { padding: 5px 10px; margin: 5px; }
    #map { height: 400px; margin-top: 20px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 6px 10px; border: 1px solid #555; text-align: center; }
  </style>
</head>
<body>

<h2>ğŸš Quick Quotes UK</h2>

<input id="pickup" placeholder="Pickup postcode or address">
<input id="delivery" placeholder="Delivery postcode or address">

<button onclick="calculateAllQuotes()">Calculate All Quotes</button>

<h3 id="result"></h3>

<div id="map"></div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
let map = L.map('map').setView([51.5, -0.12], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

// Lista vehiculelor È™i tarife
const vehicles = {
  "SWB": 1,
  "MWB": 1.05,
  "LWB": 1.1,
  "XLWB": 1.15,
  "Luton": 1.2,
  "7.5T": 2.4,
  "18T": 2.5,
  "Artic": 3
};

// FuncÈ›ie pentru a obÈ›ine coordonate dintr-un address
async function getCoords(address){
  try {
    let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
    let res = await axios.get(url);
    if(res.data.length > 0){
      return [parseFloat(res.data[0].lat), parseFloat(res.data[0].lon)];
    }
    return null;
  } catch(e) {
    alert("Error fetching coordinates");
    return null;
  }
}

// FuncÈ›ie pentru calculul tuturor costurilor
async function calculateAllQuotes() {
  const pickup = document.getElementById("pickup").value;
  const delivery = document.getElementById("delivery").value;

  if(!pickup || !delivery){ alert("Please enter both pickup and delivery"); return; }

  const p1 = await getCoords(pickup);
  const p2 = await getCoords(delivery);

  if (!p1 || !p2) { alert("Address not found"); return; }

  // È˜tergem markerii vechi
  map.eachLayer((layer) => { if(layer instanceof L.Marker) map.removeLayer(layer); });

  L.marker(p1).addTo(map);
  L.marker(p2).addTo(map);

  // CalculÄƒm distanÈ›a
  const route = await axios.get(`https://router.project-osrm.org/route/v1/driving/${p1[1]},${p1[0]};${p2[1]},${p2[0]}?overview=false`);
  const distanceMeters = route.data.routes[0].distance;
  const miles = distanceMeters / 1609;

  // CreÄƒm tabelul
  let html = `<p>Distance: ${miles.toFixed(2)} miles</p>`;
  html += `<table><tr><th>Vehicle</th><th>Transport Price (Â£)</th><th>Client Price (Â£)</th></tr>`;

  for (const [veh, rate] of Object.entries(vehicles)) {
    const transportPrice = Math.max(miles * rate, 50); // minimum Â£50
    const clientPrice = transportPrice * 1.05;          // +5% marjÄƒ
    html += `<tr><td>${veh}</td><td>Â£${transportPrice.toFixed(2)}</td><td>Â£${clientPrice.toFixed(2)}</td></tr>`;
  }

  html += `</table>`;
  document.getElementById("result").innerHTML = html;

  map.fitBounds([p1, p2]);
}
</script>

</body>
</html>
