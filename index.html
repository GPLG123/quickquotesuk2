<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quick Quotes UK - Milk Run</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input { margin: 5px; padding: 5px; width: 250px; }
    button { padding: 5px 10px; margin: 5px; }
    #map { height: 400px; margin-top: 20px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 6px 10px; border: 1px solid #555; text-align: center; }
  </style>
</head>
<body>

<h2>üöê Quick Quotes UK - Milk Run</h2>

<input id="pickup" placeholder="Pickup postcode or address">
<input id="delivery1" placeholder="Delivery postcode 1">
<input id="delivery2" placeholder="Delivery postcode 2 (optional)">
<input id="delivery3" placeholder="Delivery postcode 3 (optional)">

<button onclick="calculateAllQuotes()">Calculate All Quotes</button>

<h3 id="result"></h3>

<div id="map"></div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
let map = L.map('map').setView([51.5, -0.12], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

// Vehicles and rates (+10% applied already)
const vehicles = {
  "SWB": 1.1,
  "MWB": 1.155,
  "LWB": 1.21,
  "XLWB": 1.265,
  "Luton": 1.32,
  "7.5T": 2.64,
  "18T": 2.75,
  "Artic": 3.3
};

// Get coordinates from address
async function getCoords(address){
  try {
    let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
    let res = await axios.get(url);
    if(res.data.length > 0){
      return [parseFloat(res.data[0].lat), parseFloat(res.data[0].lon)];
    }
    return null;
  } catch(e) {
    alert("Error fetching coordinates");
    return null;
  }
}

// Calculate quotes for all vehicles (milk run)
async function calculateAllQuotes() {
  const pickup = document.getElementById("pickup").value;
  const deliveries = [
    document.getElementById("delivery1").value,
    document.getElementById("delivery2").value,
    document.getElementById("delivery3").value
  ].filter(d => d); // only non-empty deliveries

  if(!pickup || deliveries.length === 0){ alert("Enter pickup and at least 1 delivery"); return; }

  // Get coordinates
  const coordsList = [];
  const pickupCoords = await getCoords(pickup);
  if(!pickupCoords){ alert("Pickup address not found"); return; }
  coordsList.push(pickupCoords);

  for(const d of deliveries){
    const c = await getCoords(d);
    if(!c){ alert(`Delivery address not found: ${d}`); return; }
    coordsList.push(c);
  }

  // Clear old markers
  map.eachLayer(layer => { if(layer instanceof L.Marker) map.removeLayer(layer); });

  // Place markers
  coordsList.forEach((c, i) => {
    let label = (i===0) ? "Pickup" : `Delivery ${i}`;
    L.marker(c).addTo(map).bindPopup(label).openPopup();
  });

  // Calculate total distance using OSRM route between consecutive points
  let totalDistance = 0;
  for(let i=0; i<coordsList.length-1; i++){
    const from = coordsList[i];
    const to = coordsList[i+1];
    const route = await axios.get(`https://router.project-osrm.org/route/v1/driving/${from[1]},${from[0]};${to[1]},${to[0]}?overview=false`);
    totalDistance += route.data.routes[0].distance; // in meters
  }
  const miles = totalDistance / 1609; // convert to miles

  // Build result table
  let html = `<p>Total distance: ${miles.toFixed(2)} miles</p>`;
  html += `<table><tr><th>Vehicle</th><th>Transport Price (¬£)</th><th>Client Price (¬£)</th></tr>`;

  for (const [veh, rate] of Object.entries(vehicles)) {
    const transportPrice = Math.max(miles * rate, 65); // minimum ¬£65
    const clientPrice = transportPrice * 1.05; // +5% margin
    html += `<tr><td>${veh}</td><td>¬£${transportPrice.toFixed(2)}</td><td>¬£${clientPrice.toFixed(2)}</td></tr>`;
  }

  html += `</table>`;
  document.getElementById("result").innerHTML = html;

  map.fitBounds(coordsList);
}
</script>

</body>
</html>
-
